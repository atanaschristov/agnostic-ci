name: Release

on:
   workflow_dispatch:
      inputs:
         version:
            description: 'Version number for this release (e.g. 1.2.3)'
            required: true
            type: string

permissions:
   contents: write

jobs:
   run-library-ci:
      name: Run pre-release checks
      uses: ./.github/workflows/library.yml
      with:
         build-artifact: true
         version: ${{ github.event.inputs.version }}

   run-demo-ci:
      name: Run pre-release checks
      uses: ./.github/workflows/demo.yml
      with:
         version: ${{ github.event.inputs.version }}

   release:
      name: Create Manual Release
      needs: [run-library-ci, run-demo-ci] # âœ… ensures it runs AFTER artifacts are ready
      runs-on: ubuntu-latest

      steps:
         - name: Checkout repository
           uses: actions/checkout@v4
           with:
              ref: ${{ github.ref_name }}

         - name: Download build artifact
           uses: actions/download-artifact@v4
           with:
              name: build-${{ github.event.inputs.version }}-${{ github.sha }}
              path: artifacts

         - name: Download demo artifact
           uses: actions/download-artifact@v4
           with:
              name: demo-${{ github.event.inputs.version }}-${{ github.sha }}
              path: artifacts

         - name: Create GitHub Release
           uses: softprops/action-gh-release@v2
           with:
              tag_name: v${{ github.event.inputs.version }}
              name: Release v${{ github.event.inputs.version }}
              generate_release_notes: true
              files: |
                 artifacts/build-${{ github.event.inputs.version }}-${{ github.sha }}.zip
                 artifacts/demo-${{ github.event.inputs.version }}-${{ github.sha }}.zip
           env:
              GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
